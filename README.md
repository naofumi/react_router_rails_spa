## React Router SPA Framework mode integration for Ruby on Rails

Ruby on Rails has officially supported bundling of complex JavaScript frontend libraries,
first with [Webpacker](https://github.com/rails/webpacker),
and currently with [jsbundling-rails](https://github.com/rails/jsbundling-rails).
We also have [Vite Ruby](https://github.com/ElMassimo/vite_ruby) with an integrated dev server, HMR and other goodies.

However, on February 14th, 2025,
the React team announced the [official deprecation of Create React App (CRA)](https://react.dev/blog/2025/02/14/sunsetting-create-react-app).
Instead, they suggested developers should use a framework that builds single-page apps
(SPA) that can be deployed to a CDN or a static hosting service â€“
SPA frameworks such as Next.js or React Router.
Importantly,
they advised
against [building a React app from scratch](https://react.dev/learn/build-a-react-app-from-scratch)
unless your app has constraints not well-served by existing SPA frameworks.

With regard to the Ruby on Rails integration solutions described above,
none take the framework approach.
Instead, they require you to build your React app from scratch.

This gem suggests a different approach, and it allows us to integrate React SPA frameworks with Ruby on Rails.

## Intended use cases

- You want to use React as a frontend for a Ruby on Rails application.
   - The Ruby on Rails application may have ERB (Hotwire) pages in addition to React ones.
- You are not prioritizing SEO optimization for the React generated pages (you don't need React SSR/SSG).
   - You will use ERB views when SEO is a priority. 
- You do not want to host your frontend on a separate server due to costs, complexity, or authentication issues.
   - You want your React frontend to be deployed in the Ruby on Rails `public` folder.
- You have many pages, and you want to reduce the initial JavaScript payload size by using automatic code-splitting and lazy-loading.
   - You also want to ensure that code-splitting does not introduce data-fetch waterfalls that slow down page load times.

In short, you just want to use React as a frontend with minimal complexity and cost.
You also want to avoid the common pitfalls of React SPAs, such as huge JavaScript payloads which cause slow initial page loads.

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'react_router_rails_spa'
```

Then, run:

```shell
bundle install
bin/rails generate react_router_rails_spa:install
```

This will create a new directory called `frontend` inside the project root.
It will also create a React bootstrap endpoint `/react` handled by `ReactController#show`,
rake tasks for starting the dev server and building the React app.
It also provides a utility function to use the robust CSRF protection built into Ruby on Rails from your React application.

## Running in Development

Start the Ruby on Rails server and then run the following command to start the development server.

```shell
bin/rails react_router:dev
```

Access the development server from the URL outputted from this command (Typically `http://localhost:5173/react`)

The development server gives you HMR and is helpful when editing pages generated by the React app. However,
there are significant differences compared to the production environment,
especially with regard to how the React pages interact with the Ruby on Rails backend.
You are advised to build the React app access it from the Ruby on Rails server to ensure that it works as intended. 

Run the following command to build the React app. The React page will be available from the Ruby on Rails server
(`http://localhost:3000/react`)

```shell
bin/rails react_router:build
```

## Deployment

This gem integrates with the Ruby on Rails Asset pipeline.
The React Router application is automatically built whenever `bin/rails assets:precompile` is run
and no changes should be required if your Ruby on Rails application already does this.

If your deployment pipeline does not already install Node (for example, you have a "no-build" deployment for Rails),
then install it in your build environment since building the React Router application will require it.


## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/naofumi/react_router_rails_spa. This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the [code of conduct](https://github.com/naofumi/react_router_rails_spa/blob/main/CODE_OF_CONDUCT.md).

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).

## Code of Conduct

Everyone interacting in the ReactRouterRails project's codebases, issue trackers, chat rooms and mailing lists is expected to follow the [code of conduct](https://github.com/naofumi/react_router_rails_spa/blob/main/CODE_OF_CONDUCT.md).
